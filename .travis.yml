language: node_js
sudo: false
node_js:
  - 11.13.0
install:
  - yarn install
stages:
  - test
  - build
  - lint
jobs:
  include:
    - stage: test
      script: yarn test
    - script: yarn prettier:check
    - script: yarn lint
    - stage: build
      script: yarn build
    - stage: build docker
      deploy:
        provider: script
        script: "
          tag=$( git describe --abbrev=0 )
          echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin
          echo $( docker build -t bingneef/docker-nextjs:$tag . )
          echo $tag
          echo $( docker push bingneef/docker-nextjs:$tag )"
        on:
          branch: master
